# 美食攻略数据导入指南 🍴

## ✅ 已完成功能

### 1. 美食数据转换脚本
- ✅ 创建了 `cloudfunctions/init-database/food-data.js`
- ✅ 包含3篇完整美食攻略：
  - **后宅镇美食探店完全攻略**（本地人推荐，含20+家餐厅）
  - **青澳湾特色餐厅推荐**（蒸汽火锅、民谣酒吧等）
  - **云澳镇海鲜大排档**（环岛路过推荐）

### 2. ⚠️ 假数据清理
- ✅ **已清空** `initGuides()` 中的示例/假数据
- ✅ 提示用户使用"美食攻略（真实数据）"按钮
- ✅ 不再添加占位符数据

### 2. 云函数更新
- ✅ `init-database` 云函数新增 `initFood` 功能
- ✅ `huahai` 云函数新增 `getGuideById` 功能
- ✅ 初始化页面新增"美食攻略（真实数据）"按钮

### 3. ⚡ 便捷编辑入口
- ✅ **数据初始化页面**新增快速入口：
  - ⚙️ 管理后台 - 快速进入管理后台首页
  - 📝 编辑攻略 - 直接进入攻略管理页面
- ✅ **推荐入口顺序**：
  1. 我的 → 数据初始化 → 📝 编辑攻略
  2. 或：我的 → 管理后台 → 攻略管理

### 4. 图片上传管理后台
- ✅ 创建了攻略编辑页面：`pages/admin/guide-edit/`
- ✅ 支持上传封面图到云存储
- ✅ 支持上传多张图片（最多9张）
- ✅ 支持预览和删除图片
- ✅ 支持HTML富文本内容编辑

---

## 使用步骤 🚀

### 步骤一：部署云函数

1. **部署 init-database 云函数**
   ```
   右键 cloudfunctions/init-database 文件夹
   → 上传并部署：云端安装依赖
   ```

2. **部署 huahai 云函数**（如果还没部署）
   ```
   右键 cloudfunctions/huahai 文件夹
   → 上传并部署：云端安装依赖
   ```

### 步骤二：导入美食数据

#### 方法1：使用初始化页面（推荐）

1. **编译运行小程序**
2. **进入个人中心** → 滚动到底部
3. **点击"数据初始化"**
4. **点击"🍴 美食攻略（真实数据）"按钮**
5. **等待执行完成**，查看日志输出
6. **返回首页**，查看美食推荐栏目

#### 方法2：云函数控制台

1. 打开微信开发者工具
2. 点击「云开发」→「云函数」
3. 找到 `init-database` 云函数
4. 点击「云端测试」
5. 输入测试参数：
   ```json
   {
     "type": "initFood",
     "password": "huahai2026"
   }
   ```
6. 点击「测试」

### 步骤三：上传真实图片

#### 1. 进入管理后台

1. 在个人中心，点击"管理后台"
2. 输入密码：`huahai2026`
3. 进入"攻略管理"页面

#### 2. 编辑攻略并上传图片

1. 找到刚导入的美食攻略
2. 点击"编辑"按钮
3. 在编辑页面：
   - **上传封面图**：点击"上传封面"按钮，选择本地图片
   - **上传图片列表**：点击"添加图片"按钮，可上传最多9张
   - 编辑其他内容后点击"更新攻略"

#### 3. 图片上传说明

**图片会自动上传到云存储：**
- 封面图路径：`guides/covers/`
- 内容图片路径：`guides/images/`

**支持的操作：**
- ✅ 从相册选择图片
- ✅ 拍照上传
- ✅ 预览大图
- ✅ 删除已上传图片

---

## 数据结构说明 📊

### 美食攻略包含的字段

```javascript
{
  title: "后宅镇美食探店完全攻略",
  category: "food",          // 分类：food/route/spot/info
  tags: ["海鲜", "地道"],     // 标签数组
  cover: "cloud://xxx",       // 封面图（云存储URL）
  images: ["cloud://xxx"],     // 图片列表
  summary: "简要描述",        // 摘要
  content: "<h3>详细内容</h3>", // 支持HTML
  address: "详细地址",
  location: {
    latitude: 23.4234,
    longitude: 117.0234
  },
  info: [                       // 信息项
    { label: "人均消费", value: "60-150元" }
  ],
  weight: 10,                  // 权重（排序用）
  status: "published",          // 状态
  views: 0,                    // 浏览量
  likes: 0                     // 点赞数
}
```

---

## 导航测试 🧭

### 测试步骤

1. **打开首页**
2. **点击分类筛选** → 选择"美食推荐"
3. **查看美食攻略列表** → 应该看到3篇美食攻略
4. **点击任一攻略** → 进入详情页
5. **测试导航功能** → 点击"去这里"按钮
6. **测试收藏功能** → 点击收藏按钮
7. **查看图片** → 确认图片正常显示

---

## 常见问题 ❓

### Q1: 点击"美食攻略（真实数据）"没有反应？

**A: 检查云函数是否已部署**
- 右键 `cloudfunctions/init-database` 文件夹
- 查看是否有"云端安装依赖"选项
- 如果有"上传并部署"，说明还没部署成功

### Q2: 图片上传失败？

**A: 检查云存储权限**
1. 打开「云开发」→「云存储」
2. 点击「设置」→「权限设置」
3. 确保设置为："所有用户可读，仅创建者可写"

### Q3: 图片不显示？

**A: 可能的原因：**
1. 图片还在上传中，稍等片刻
2. 云存储域名还未生效，等待1-2分钟
3. 图片路径错误，检查 cloud:// URL 是否正确

### Q4: 数据库在哪里看？

**A: 查看数据库**
1. 点击「云开发」→「数据库」
2. 找到 `guides` 集合
3. 查看导入的数据记录

### Q5: 如何修改密码？

**A: 修改以下文件中的密码：**
- `cloudfunctions/huahai/index.js` 的第315行
- `cloudfunctions/init-database/index.js` 的第22行
- 修改后重新部署云函数

---

## 下一步建议 📝

### 1. 上传真实图片

从攻略文件中提取的图片路径：
```
D:\Program Files\xwechat_files\...
```

**建议操作：**
1. 将这些图片保存到本地文件夹
2. 通过管理后台上传到云存储
3. 更新攻略数据中的图片URL

### 2. 补充地理位置

当前所有餐厅使用统一的经纬度：
```javascript
latitude: 23.4234,
longitude: 117.0234
```

**建议：**
使用百度地图/高德地图获取每个餐厅的实际经纬度

### 3. 添加更多分类

目前可以添加的攻略分类：
- **food**: 美食推荐 ✅ 已导入
- **route**: 游玩路线（可后续添加）
- **spot**: 景点打卡（可后续添加）
- **info**: 实用信息（可后续添加）

---

## 技术支持 💻

如有问题，请检查：
1. 云函数是否部署成功
2. 数据库集合 `guides` 是否存在
3. 云存储是否已开通
4. 控制台是否有错误日志

---

**祝您使用愉快！** 🌊
