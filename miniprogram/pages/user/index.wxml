<!--pages/user/index.wxml-->
<view class="user-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-header">
    <view class="user-bg"></view>
    <view class="user-info">
      <image
        class="user-avatar"
        src="{{userInfo ? userInfo.avatarUrl : '/images/default-avatar.png'}}"
        mode="aspectFill"
      ></image>
      <view class="user-detail">
        <text class="user-name">{{userInfo ? userInfo.nickName : 'ç‚¹å‡»æˆæƒç™»å½•'}}</text>
        <text class="user-desc" wx:if="{{hasUserInfo}}">æ¬¢è¿ä½¿ç”¨ç”»æµ·æ°‘å®¿</text>
      </view>
      <button
        class="auth-btn"
        wx:if="{{!hasUserInfo}}"
        bindtapgetUserProfile
      >æˆæƒ</button>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section card">
    <view class="stat-item">
      <text class="stat-value">{{favorites.length}}</text>
      <text class="stat-label">æˆ‘çš„æ”¶è—</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value">{{history.length}}</text>
      <text class="stat-label">æµè§ˆå†å²</text>
    </view>
  </view>

  <!-- æˆ‘çš„æ”¶è— -->
  <view class="favorites-section card" wx:if="{{hasUserInfo}}">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„æ”¶è—</text>
      <text class="section-empty" wx:if="{{favorites.length === 0}}">æš‚æ— æ”¶è—</text>
    </view>

    <view class="favorites-list" wx:if="{{favorites.length > 0}}">
      <view
        class="favorite-item"
        wx:for="{{favorites}}"
        wx:key="_id"
        data-id="{{item.guide._id}}"
        bindtap="openGuide"
      >
        <image class="favorite-image" src="{{item.guide.cover}}" mode="aspectFill"></image>
        <view class="favorite-content">
          <text class="favorite-title">{{item.guide.title}}</text>
          <text class="favorite-time">{{item.createTimeStr}}</text>
        </view>
        <view
          class="favorite-remove"
          catchtap="removeFavorite"
          data-id="{{item.guide._id}}"
          data-index="{{index}}"
        >
          <text>âœ•</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æµè§ˆå†å² -->
  <view class="history-section card" wx:if="{{hasUserInfo}}">
    <view class="section-header">
      <text class="section-title">æµè§ˆå†å²</text>
      <text class="clear-btn" bindtap="clearHistory" wx:if="{{history.length > 0}}">æ¸…ç©º</text>
    </view>

    <view class="history-list" wx:if="{{history.length > 0}}">
      <view
        class="history-item"
        wx:for="{{history}}"
        wx:key="*this"
        data-id="{{item.id}}"
        bindtap="openGuide"
      >
        <image class="history-image" src="{{item.cover}}" mode="aspectFill"></image>
        <view class="history-content">
          <text class="history-title">{{item.title}}</text>
          <text class="history-time">{{item.time}}</text>
        </view>
      </view>
    </view>

    <view class="empty-state" wx:if="{{history.length === 0}}">
      <text class="empty-text">æš‚æ— æµè§ˆè®°å½•</text>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section card">
    <view class="menu-item" bindtap="contactService">
      <view class="menu-left">
        <text class="menu-icon">ğŸ“</text>
        <text class="menu-label">è”ç³»å®¢æœ</text>
      </view>
      <text class="menu-arrow">â€º</text>
    </view>

    <view class="menu-divider"></view>

    <view class="menu-item" bindtap="showAbout">
      <view class="menu-left">
        <text class="menu-icon">â„¹ï¸</text>
        <text class="menu-label">å…³äºæˆ‘ä»¬</text>
      </view>
      <text class="menu-arrow">â€º</text>
    </view>

    <!-- æ•°æ®åˆå§‹åŒ–å…¥å£ï¼ˆéšè—ï¼‰ -->
    <view class="menu-item" bindtap="goToInit">
      <view class="menu-left">
        <text class="menu-icon">âš™ï¸</text>
        <text class="menu-label">æ•°æ®åˆå§‹åŒ–</text>
      </view>
      <text class="menu-arrow">â€º</text>
    </view>
  </view>

  <!-- æœªç™»å½•æç¤º -->
  <view class="login-tip" wx:if="{{!hasUserInfo}}">
    <text class="tip-text">ç™»å½•åå¯ä½¿ç”¨æ”¶è—å’Œå†å²åŠŸèƒ½</text>
  </view>
</view>
