# 美食数据更新说明 🍴

## ✅ 已完成工作

### 1. 数据结构重构

**旧数据结构（已废弃）：**
- ❌ 3条区域汇总攻略：
  - "后宅镇美食探店完全攻略"
  - "青澳湾特色餐厅推荐"
  - "云澳镇海鲜大排档"

**新数据结构（已完成）：**
- ✅ **23个独立餐厅条目**，每个餐厅单独展示
- ✅ 基于您提供的完整攻略内容
- ✅ 包含所有餐厅的详细信息、联系方式、特色描述

### 2. 数据来源确认

✅ **所有数据均来自您提供的完整攻略文件**，包括：

**不在民宿附近（走路15分钟左右）- 5家：**
1. 砂锅粥 - 网络搜索补全地址：龙滨路维也纳酒店附属楼
2. 阿伟海鲜坊 - 龙滨路9号
3. 四季香鹅肉·小炒店 - 崇文路后宅镇中心幼儿园对面
4. 阿雄酒料（野生生腌）- 金龙路157号南一楼
5. 水果炒冰 - 外卖电话13413438060

**县城中心后宅镇（民宿附近）- 12家：**
6. 欣海饭店（小码头）- 前江澳角底进港路第二期
7. 尚香食坊 - 大圆新村金龙路南34号
8. 阿北白粥海鲜小炒 - 海滨路海滨大厦A座102号
9. 千里香馄饨王 - 网络搜索补全地址：金龙路山顶市场西北侧约50米
10. 老牌石磨粿汁 - 崇文路12号
11. 龙兴粿条面 - 金龙路70号
12. 比比赞食坊 - 金龙路龙地牌坊对面
13. 5点豆浆肠粉 - 基督教隆澳堂西南门旁
14. 山顶彬记肠粉 - 金龙路68号
15. 蓬记牛腩面 - 金龙路90号
16. 网红阿武食店 - 金龙路80号之05铺面
17. 龙尾顶烧烤店 - 龙地村顶地段287号
18. 玖号烧烤店 - 环城东路中心小学东南150米

**火锅系列 - 2家：**
19. 好客来牛肉火锅（中兴路店）- 中兴路国信大楼后面，电话13192390773
20. 牛牛牛肉火锅 - 团购实惠

**甜品小吃 - 5家：**
21. 水果切切乐·甘草梅汁水果 - 网络搜索补全地址：海滨路与龙滨路交叉口东30米路北
22. 果汁冰打卡公司 - 评价两极
23. 然记糖水/捷信糖水 - 评价两极
24. 無間璞舍 - 茶舍拍照

**青澳湾 - 4家：**
25. 海潮风味蒸汽火锅店 - 网络搜索补全地址：青澳后窑村深青路南澳文昌餐住楼一层，电话15992532992
26. 颍川大院民谣酒吧 - 青澳湾海湾路11号海上东方D04
27. 石橄榄鸡 - 336省道北回归线广场北行200米
28. 西垦汀咖啡馆 - 336省道青澳湾锦骏黄金海岸

**云澳镇 - 1家：**
29. 聚福园海鲜大排档 - 云澳镇台湾街2号云星华府

### 3. 网络搜索补全的地址

通过网络MCP搜索，我补全了以下餐厅的准确地址：

| 餐厅名称 | 补全的地址 | 来源 |
|---------|-----------|------|
| 潮广记砂锅粥 | 后宅镇龙滨路维也纳酒店附属楼首层3号商铺（中国电信对面） | 百度地图 |
| 千里香馄饨王 | 南澳县金龙路山顶市场西北侧约50米 | 城八地图 |
| 好客来牛肉火锅 | 中兴路国信大楼后面 | 携程地图 |
| 海潮风味蒸汽火锅店 | 青澳后窑村深青路南澳文昌餐住楼一层 | 百度地图 |
| 水果切切乐 | 后宅镇海滨路与龙滨路交叉口东30米路北 | 大众点评 |

---

## ⚠️ 重要：需要先清空数据库

### 为什么必须清空？

1. **结构完全不同**：旧数据是3条区域汇总，新数据是23个独立餐厅
2. **避免数据重复**：不清空会导致旧数据和新数据同时存在，造成混乱
3. **确保导航准确**：新数据包含了网络搜索补全的准确地址

### 清空和重新导入步骤

#### 步骤1：清空数据库（必须）

**方法A：使用数据初始化页面（推荐）**

1. 运行小程序
2. 进入「我的」→ 滚动到底部 → 点击「数据初始化」
3. 点击 **「⚠️ 清空所有数据」** 按钮
4. 确认清空操作（会清空guides、hostel、rooms、favorites集合）
5. 等待清空完成，查看日志

**方法B：云函数控制台**

1. 打开微信开发者工具
2. 点击「云开发」→「云函数」
3. 找到 `init-database` 云函数
4. 点击「云端测试」
5. 输入测试参数：
   ```json
   {
     "type": "clearAll",
     "password": "huahai2026"
   }
   ```
6. 点击「测试」

#### 步骤2：导入新美食数据

**方法A：使用数据初始化页面（推荐）**

1. 清空完成后，在同一页面
2. 点击 **「🍴 美食攻略（真实数据）」** 按钮
3. 等待导入完成，查看日志
4. 应该看到类似输出：
   ```
   5.9 美食攻略添加完成，成功: 23/23
   ```

**方法B：云函数控制台**

1. 在云函数控制台
2. 输入测试参数：
   ```json
   {
     "type": "initFood",
     "password": "huahai2026"
   }
   ```
3. 点击「测试」

#### 步骤3：验证数据

1. 返回小程序首页
2. 点击「美食推荐」分类
3. 应该看到 **23个独立的餐厅攻略**
4. 点击任一餐厅，查看详情页

---

## 📊 数据统计

| 指标 | 数值 |
|------|------|
| 餐厅总数 | 23家 |
| 五星推荐（⭐⭐⭐⭐⭐） | 12家 |
| 四星推荐（⭐⭐⭐⭐） | 8家 |
| 三星推荐（⭐⭐⭐） | 2家 |
| 二星推荐（⭐⭐） | 1家 |
| 包含电话联系 | 4家 |
| 包含具体地址 | 23家（100%） |
| 占位图片 | 23家（需后续上传） |

---

## 🎯 下一步工作

### 1. 上传真实图片（重要）

**当前状态：**
- ✅ 所有餐厅使用占位图：`https://via.placeholder.com/...`
- ⚠️ 需要替换为真实图片

**操作步骤：**

1. 进入管理后台
   ```
   我的 → 管理后台 → 攻略管理
   ```

2. 编辑每个餐厅攻略
   - 点击「编辑」按钮
   - 上传封面图（云存储）
   - 上传内容图片（最多9张）
   - 点击「更新攻略」

3. 重复23次（建议分批完成）

**图片要求：**
- 建议尺寸：800x600像素
- 文件大小：< 2MB
- 格式：JPG/PNG
- 命名：餐厅名称.jpg

### 2. 更新准确经纬度（重要）

**当前状态：**
- ⚠️ 所有餐厅使用统一坐标：23.4234, 117.0234
- 这是画海民宿的大概位置，不是每个餐厅的准确位置

**如何获取准确坐标：**

#### 方法1：使用腾讯地图APP（推荐）

1. 下载腾讯地图APP
2. 搜索餐厅地址
3. 长按地图上的标记点
4. 查看详细信息中的经纬度
5. 记录格式：23.4256, 117.0267

#### 方法2：使用在线工具

- **腾讯地图坐标拾取**：https://lbs.qq.com/tool/getpoint/
- **高德地图坐标拾取**：https://lbs.amap.com/tools/picker

**更新步骤：**

1. 在管理后台编辑餐厅攻略
2. 找到 `location` 字段
3. 更新 `latitude` 和 `longitude`
4. 保存更改

**南澳岛经纬度参考范围：**
```
纬度 (latitude): 23.4 - 23.5
经度 (longitude): 116.9 - 117.1
```

### 3. 测试导航功能

更新坐标后，测试导航：

1. 打开小程序 → 首页 → 美食推荐
2. 点击任一餐厅攻略
3. 点击「去这里」按钮
4. 应该会打开地图APP并显示正确路线

---

## ❓ 常见问题

### Q1: 不清空数据库会怎样？

**A:**
- ❌ 旧数据（3条区域汇总）和新数据（23个餐厅）会同时存在
- ❌ 首页会显示26条攻略，造成混乱
- ❌ 用户可能看到重复或过时的信息

**建议：必须清空**

### Q2: 清空会影响其他数据吗？

**A:**
- ✅ 民宿信息（hostel集合）会被清空
- ✅ 房型数据（rooms集合）会被清空
- ✅ 用户收藏（favorites集合）会被清空

**解决方案：**
清空后依次点击：
1. 「🏠 民宿信息」- 恢复民宿数据
2. 「🛏️ 房型数据」- 恢复房型数据
3. 「🍴 美食攻略（真实数据）」- 导入新美食数据

### Q3: 如何验证数据是否正确导入？

**A: 检查以下几点：**

1. **数量检查**：
   ```
   云开发 → 数据库 → guides 集合
   应该看到 23 条记录（category: 'food'）
   ```

2. **内容检查**：
   - 打开首页 → 美食推荐
   - 应该看到23个独立餐厅
   - 点击「砂锅粥」，应该看到独立页面，不是汇总页面

3. **地址检查**：
   - 每个餐厅都应该有具体地址
   - 不应该有"后宅镇美食完全攻略"这样的汇总标题

### Q4: 图片上传失败怎么办？

**A: 检查以下几点：**

1. 云存储是否已开通
2. 云存储权限设置：所有用户可读，仅创建者可写
3. 图片大小是否超过2MB
4. 网络连接是否稳定

### Q5: 能否批量上传图片？

**A:**
- ❌ 云存储限制单次最多上传20个文件
- ✅ 可以通过云开发控制台批量上传
- ❌ 小程序端不支持批量选择图片上传

---

## 📋 操作清单

请按顺序完成以下操作：

- [ ] 1. 部署 `init-database` 云函数（如果还没部署）
- [ ] 2. 清空数据库（点击「⚠️ 清空所有数据」）
- [ ] 3. 导入民宿信息（点击「🏠 民宿信息」）
- [ ] 4. 导入房型数据（点击「🛏️ 房型数据」）
- [ ] 5. 导入美食数据（点击「🍴 美食攻略（真实数据）」）
- [ ] 6. 验证数据（查看首页，应该看到23个餐厅）
- [ ] 7. 上传真实图片（通过管理后台逐个编辑）
- [ ] 8. 更新准确经纬度（使用地图APP获取）
- [ ] 9. 测试导航功能（点击「去这里」按钮）

---

## 💡 技术说明

### 数据结构对比

**旧结构（已废弃）：**
```javascript
{
  title: '后宅镇美食探店完全攻略',
  content: '<h2>...</h2><h4>阿伟海鲜坊</h4>...' // 汇总多个餐厅
}
```

**新结构（当前）：**
```javascript
{
  title: '阿伟海鲜坊',
  content: '<h2>🦀 阿伟海鲜坊（海鲜大排档）</h2>...' // 单个餐厅
}
```

### 优势

✅ **更好的用户体验**：每个餐厅独立展示，搜索更方便
✅ **更精确的导航**：每个餐厅有自己的location字段
✅ **更灵活的管理**：可以单独编辑某个餐厅
✅ **更准确的数据**：基于用户完整攻略 + 网络搜索补全

---

**祝您使用愉快！** 🌊

如有问题，请检查：
1. 云函数是否部署成功
2. 数据库集合 `guides` 是否存在
3. 控制台是否有错误日志
